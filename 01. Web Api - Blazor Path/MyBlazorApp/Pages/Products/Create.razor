@page "/products/create"

@using MyFirstApi.Client
@using MyBlazorApp.ViewModel.Products

@inject ProductsClient ProductsClient
@inject NavigationManager NavManager

<h1>New Product</h1>

<NavLink href="/products">
    Back
</NavLink>

<EditForm Model="@viewModel" OnValidSubmit="@OnSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <!-- Name -->
    <div class="form-group row">
        <label class="col-form-label col-2">Name</label>
        <div class="col-md-4">
            <InputText class="form-control" @bind-Value="viewModel.Name" />
        </div>
    </div>
    <!-- Description -->
    <div class="form-group row">
        <label class="col-form-label col-2">Description</label>
        <div class="col-md-4">
            <InputTextArea class="form-control" @bind-Value="viewModel.Description" />
        </div>
    </div>
    <!-- Price -->
    <div class="form-group row">
        <label class="col-form-label col-2">Price</label>
        <div class="col-md-4">
            <InputNumber class="form-control" @bind-Value="viewModel.Price" />
        </div>
    </div>
    <!-- Submit -->
    <div class="form-group row">
        <div class="col-md-10 ml-auto">
            <button class="btn btn-primary">
                Save
            </button>
        </div>
    </div>
</EditForm>



@code {
    private CreateProductsViewModel viewModel = new();

    private async Task OnSubmit()
    {
        var productDto = new ProductModel
        {
            Description = viewModel.Description,
            Name = viewModel.Name,
            Price = viewModel.Price
        };

        await ProductsClient.CreateProductAsync(productDto);

        NavManager.NavigateTo("/products");
    }
}